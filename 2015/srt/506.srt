X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

1
00:00:23,806 --> 00:00:25,486 A:middle
>> Welcome to session 506.

2
00:00:25,486 --> 00:00:27,446 A:middle
My name is Tim Monroe,
and I am a member

3
00:00:27,446 --> 00:00:30,576 A:middle
of the AVFoundation engineering
Team, and I want to talk

4
00:00:30,576 --> 00:00:33,756 A:middle
to you today about editing
movies in AVFoundation.

5
00:00:34,656 --> 00:00:36,816 A:middle
The takeaway message
is very simple.

6
00:00:37,626 --> 00:00:39,696 A:middle
AVFoundation provides
new classes

7
00:00:39,696 --> 00:00:41,966 A:middle
for editing QuickTime
movie files.

8
00:00:42,546 --> 00:00:44,056 A:middle
Oh, come on.

9
00:00:44,056 --> 00:00:44,936 A:middle
You can do better than that.

10
00:00:44,936 --> 00:00:45,846 A:middle
Let's hear some applause.

11
00:00:46,016 --> 00:00:47,756 A:middle
[Applause]

12
00:00:47,756 --> 00:00:48,106 A:middle
Thank you.

13
00:00:50,726 --> 00:00:53,166 A:middle
Now, I am excited about
this capability because,

14
00:00:53,166 --> 00:00:56,466 A:middle
as you'll see in a little
bit, this provides the tools

15
00:00:56,466 --> 00:01:01,116 A:middle
that I need to manage a personal
project that I have been working

16

17
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

18
00:00:56,466 --> 00:01:01,116 A:middle
that I need to manage a personal
project that I have been working

19
00:01:01,116 --> 00:01:04,346 A:middle
on for about the last ten
years, and in some sense,

20
00:01:04,346 --> 00:01:07,786 A:middle
it brings to a culmination a
project that I have been doing

21
00:01:07,786 --> 00:01:09,776 A:middle
for about the last 35 years.

22
00:01:10,146 --> 00:01:11,786 A:middle
So I've got a lot of
skin in this game,

23
00:01:11,786 --> 00:01:14,426 A:middle
and I hope you'll enjoy
the presentation today.

24
00:01:15,016 --> 00:01:18,416 A:middle
So what does it mean to say we
can edit QuickTime movie files.

25
00:01:18,466 --> 00:01:20,426 A:middle
Well, we can open
QuickTime movie files

26
00:01:20,936 --> 00:01:24,756 A:middle
and perform range-based
editing on movies and tracks.

27
00:01:24,756 --> 00:01:27,696 A:middle
So you select a section,
a segment of a movie,

28
00:01:27,916 --> 00:01:30,126 A:middle
and copy it into
some other movie.

29
00:01:30,866 --> 00:01:32,366 A:middle
We can add and remove tracks.

30
00:01:32,816 --> 00:01:35,376 A:middle
We can set tracks
associations between tracks --

31
00:01:35,376 --> 00:01:38,386 A:middle
so say to mark one track at
a chapter track of another.

32
00:01:40,176 --> 00:01:43,076 A:middle
We can add or modify
track and movie metadata.

33
00:01:44,326 --> 00:01:47,136 A:middle
And we can create movie
files and what I am going

34
00:01:47,136 --> 00:01:49,556 A:middle
to call URL sample
reference movie files.

35
00:01:49,556 --> 00:01:53,396 A:middle
So how are we going
to do this today?

36
00:01:53,706 --> 00:01:58,176 A:middle
First thing I am going to do
is situate these new classes

37
00:01:59,066 --> 00:02:02,766 A:middle
in respect to the existing
classes we have in AVFoundation.

38

39
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

40
00:01:59,066 --> 00:02:02,766 A:middle
in respect to the existing
classes we have in AVFoundation.

41
00:02:02,766 --> 00:02:05,986 A:middle
Then I am going to do sort of
an API crawl where I go through

42
00:02:05,986 --> 00:02:07,336 A:middle
and touch on the high points

43
00:02:07,336 --> 00:02:10,196 A:middle
of the new methods we've
added to these classes.

44
00:02:10,985 --> 00:02:12,706 A:middle
And finally, I am going
to go back and talk

45
00:02:12,706 --> 00:02:14,876 A:middle
about this personal
project that I've mentioned

46
00:02:15,196 --> 00:02:19,206 A:middle
and show you very clearly how
these new capabilities allow me

47
00:02:19,206 --> 00:02:21,696 A:middle
to do interesting things
with this large amount

48
00:02:21,696 --> 00:02:22,856 A:middle
of data that I've collected.

49
00:02:24,066 --> 00:02:28,006 A:middle
So let's talk about the
AVFoundation editing classes.

50
00:02:28,496 --> 00:02:30,476 A:middle
If you've done any
work with AVFoundation

51
00:02:30,476 --> 00:02:35,096 A:middle
in the editing space, you
know that we have two classes

52
00:02:35,096 --> 00:02:38,096 A:middle
that you work with, the
operative abstraction is

53
00:02:38,096 --> 00:02:41,766 A:middle
that of a composition, and so
you can have AVCompositions

54
00:02:41,956 --> 00:02:45,346 A:middle
and at the mutable level,
AVMutableCompositions.

55
00:02:45,786 --> 00:02:47,826 A:middle
Now, compositions are
really cool stuff.

56
00:02:47,826 --> 00:02:50,176 A:middle
You can make some really
exciting presentations.

57
00:02:50,676 --> 00:02:52,766 A:middle
There's just one
pesky little drawback

58
00:02:52,836 --> 00:02:54,926 A:middle
to AVMutableComposition,

59
00:02:55,506 --> 00:02:58,216 A:middle
which is there's no
standard file format

60
00:02:58,536 --> 00:03:01,306 A:middle
into which you can
serialize your composition.

61

62
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

63
00:02:58,536 --> 00:03:01,306 A:middle
into which you can
serialize your composition.

64
00:03:02,196 --> 00:03:03,436 A:middle
So it makes it hard

65
00:03:03,436 --> 00:03:05,946 A:middle
to interchange your
snazzy composition

66
00:03:05,946 --> 00:03:07,326 A:middle
with other applications.

67
00:03:08,306 --> 00:03:11,416 A:middle
Well, when we move to
AVMovie and AVMutableMovie,

68
00:03:11,446 --> 00:03:14,306 A:middle
that problem goes away
because this is tied

69
00:03:14,306 --> 00:03:16,956 A:middle
to the QuickTime
movie file format.

70
00:03:17,186 --> 00:03:20,266 A:middle
We can now open these, edit
them, and write them back.

71
00:03:21,256 --> 00:03:25,186 A:middle
At the track level, we
have a similar setup.

72
00:03:25,456 --> 00:03:28,636 A:middle
As you know, a composition is
composed of composition tracks,

73
00:03:28,926 --> 00:03:29,976 A:middle
and at the mutable level,

74
00:03:29,976 --> 00:03:32,136 A:middle
we have AVMutableComposition
tracks.

75
00:03:32,866 --> 00:03:36,466 A:middle
In El Capitan, we are adding two
new classes at the track level,

76
00:03:36,466 --> 00:03:39,326 A:middle
AVMovieTrack and
AVMutableMovieTrack.

77
00:03:41,116 --> 00:03:43,576 A:middle
So we have, really, five
new classes that you have

78
00:03:43,576 --> 00:03:47,756 A:middle
to worry about, movie and
mutable movie, movie track

79
00:03:47,756 --> 00:03:48,856 A:middle
and mutable movie track,

80
00:03:48,856 --> 00:03:52,876 A:middle
and then this fifth class
called AVMediaDataStorage.

81
00:03:53,276 --> 00:03:56,686 A:middle
That's a very simple class,
and its whole job in life is

82
00:03:56,686 --> 00:04:00,836 A:middle
to indicate where you want new
sample data that you are writing

83

84
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

85
00:03:56,686 --> 00:04:00,836 A:middle
to indicate where you want new
sample data that you are writing

86
00:04:00,836 --> 00:04:03,286 A:middle
into a file to end up.

87
00:04:05,796 --> 00:04:10,636 A:middle
So an AVMovie represents the
data in an audiovisual file

88
00:04:10,636 --> 00:04:13,596 A:middle
that conforms to the
QuickTime movie file format.

89
00:04:14,196 --> 00:04:15,906 A:middle
Now, if you are familiar
with QuickTime movies,

90
00:04:15,906 --> 00:04:18,896 A:middle
you know that there are also a
number of related file formats

91
00:04:19,505 --> 00:04:23,226 A:middle
that were devised based on the
QuickTime movie file format,

92
00:04:23,586 --> 00:04:26,036 A:middle
and these are collectively
called ISO base media

93
00:04:26,036 --> 00:04:27,106 A:middle
file formats.

94
00:04:27,526 --> 00:04:30,566 A:middle
And AVMovie and mutable movie
can handle these just as well

95
00:04:30,596 --> 00:04:32,386 A:middle
as they can QuickTime
movie files.

96
00:04:33,516 --> 00:04:37,626 A:middle
Now, what's the key
feature about these files?

97
00:04:37,626 --> 00:04:39,096 A:middle
From my point of
view, it's this,

98
00:04:39,526 --> 00:04:42,956 A:middle
that the file format
enforces a strict separation

99
00:04:42,956 --> 00:04:47,746 A:middle
between sample data and the data
that organizes that sample data

100
00:04:47,746 --> 00:04:49,176 A:middle
into tracks and movies.

101
00:04:49,726 --> 00:04:55,966 A:middle
So here's a basic diagram
of a QuickTime movie file.

102
00:04:56,386 --> 00:04:58,796 A:middle
It starts with what's
called a file type box,

103
00:04:59,136 --> 00:05:02,596 A:middle
and this is a very simple little
bit of data that indicates

104

105
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

106
00:04:59,136 --> 00:05:02,596 A:middle
and this is a very simple little
bit of data that indicates

107
00:05:02,596 --> 00:05:04,056 A:middle
which of the file formats

108
00:05:04,056 --> 00:05:06,416 A:middle
in this family this
file conforms to.

109
00:05:07,276 --> 00:05:09,916 A:middle
There's also a movie box
which, as I just said,

110
00:05:09,916 --> 00:05:13,566 A:middle
is the organizing information
about all that sample data,

111
00:05:13,966 --> 00:05:15,566 A:middle
which is found in its own box.

112
00:05:16,326 --> 00:05:20,256 A:middle
Now, the order of most
of this is arbitrary.

113
00:05:20,646 --> 00:05:22,736 A:middle
The file type box
has to come first,

114
00:05:23,086 --> 00:05:25,526 A:middle
but the other boxes can come
in pretty much any order.

115
00:05:25,526 --> 00:05:28,356 A:middle
So we could have the movie
box at the end of the file,

116
00:05:28,926 --> 00:05:33,306 A:middle
it could be situated between
a couple of sample data boxes,

117
00:05:33,706 --> 00:05:36,426 A:middle
there can even be parts of
the file that are unused.

118
00:05:36,456 --> 00:05:39,516 A:middle
Maybe they used to contain
data, but they don't anymore.

119
00:05:41,056 --> 00:05:42,546 A:middle
Now, what's in this movie box?

120
00:05:42,736 --> 00:05:45,086 A:middle
Well, there are three types of
information that we are going

121
00:05:45,086 --> 00:05:46,356 A:middle
to be concerned with here today.

122
00:05:46,856 --> 00:05:49,746 A:middle
First is what I like to
call global settings.

123
00:05:50,106 --> 00:05:51,976 A:middle
This is information that without

124
00:05:51,976 --> 00:05:53,746 A:middle
which you wouldn't
really have a movie,

125
00:05:54,186 --> 00:05:56,486 A:middle
things like how many
tracks are in the movie,

126
00:05:56,866 --> 00:05:58,436 A:middle
what's the duration
of the movie,

127
00:05:58,876 --> 00:06:02,496 A:middle
when was this file created,
and what's the preferred rate

128

129
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

130
00:05:58,876 --> 00:06:02,496 A:middle
when was this file created,
and what's the preferred rate

131
00:06:02,496 --> 00:06:04,866 A:middle
that you would like
this played back at.

132
00:06:05,326 --> 00:06:09,396 A:middle
There's also in a movie box
some metadata, which is sort

133
00:06:09,396 --> 00:06:12,916 A:middle
of optional data that isn't
strictly speaking necessary

134
00:06:12,916 --> 00:06:16,006 A:middle
for the playback of the
media, but is useful to have.

135
00:06:16,286 --> 00:06:18,526 A:middle
And this would be stuff
like a copyright statement,

136
00:06:18,946 --> 00:06:21,866 A:middle
an indication of who the
author, what the title is,

137
00:06:22,396 --> 00:06:24,746 A:middle
and maybe even some
custom metadata that you

138
00:06:24,746 --> 00:06:27,346 A:middle
or some other app has
written into this movie box.

139
00:06:28,076 --> 00:06:29,766 A:middle
The last thing that
you will find

140
00:06:29,766 --> 00:06:33,746 A:middle
in a movie box are track
boxes, and these are pieces

141
00:06:33,746 --> 00:06:36,216 A:middle
of information that define
the tracks in the movie.

142
00:06:37,546 --> 00:06:39,336 A:middle
So they contain the track type,

143
00:06:40,086 --> 00:06:44,506 A:middle
they point to the sample data
that's needed for the track.

144
00:06:45,186 --> 00:06:46,826 A:middle
They also contain
track metadata.

145
00:06:46,826 --> 00:06:48,806 A:middle
And again, you can write
custom track metadata

146
00:06:48,806 --> 00:06:49,686 A:middle
in there if you'd like.

147
00:06:50,386 --> 00:06:53,216 A:middle
And there's also information
about track association,

148
00:06:53,216 --> 00:06:56,156 A:middle
so how this track relates to
other tracks in the movie.

149
00:06:56,716 --> 00:07:01,606 A:middle
So the key feature here is that
the sample data location --

150

151
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

152
00:06:56,716 --> 00:07:01,606 A:middle
So the key feature here is that
the sample data location --

153
00:07:01,606 --> 00:07:04,816 A:middle
so the sample data itself is
not contained in the track box.

154
00:07:05,376 --> 00:07:08,406 A:middle
The track box contains
references

155
00:07:08,846 --> 00:07:16,086 A:middle
to the sample data,
sort of like this.

156
00:07:16,816 --> 00:07:19,666 A:middle
Now, it's possible for the
sample data that a track refers

157
00:07:19,666 --> 00:07:22,036 A:middle
to exist in another
file altogether,

158
00:07:22,326 --> 00:07:24,816 A:middle
so you can have external
sample references.

159
00:07:26,146 --> 00:07:29,606 A:middle
It's even possible for the
sample references to refer only

160
00:07:29,606 --> 00:07:30,926 A:middle
to external sample data.

161
00:07:31,506 --> 00:07:34,766 A:middle
Now, when we have this
situation, the little movie box

162
00:07:34,766 --> 00:07:38,566 A:middle
and its file type box is called
a sample reference movie file.

163
00:07:39,066 --> 00:07:42,316 A:middle
So there's no actual
data in that box;

164
00:07:42,596 --> 00:07:44,176 A:middle
it just points to
data elsewhere.

165
00:07:44,686 --> 00:07:48,906 A:middle
Now, it turns out that this
is an incredibly powerful tool

166
00:07:50,096 --> 00:07:52,746 A:middle
to have available when you
are working with media files.

167
00:07:53,826 --> 00:07:54,396 A:middle
Why is that?

168
00:07:54,396 --> 00:07:58,016 A:middle
Because I can edit that small
little bit of information

169
00:07:58,266 --> 00:08:02,186 A:middle
and never have to touch that
huge amount of media data.

170

171
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

172
00:07:58,266 --> 00:08:02,186 A:middle
and never have to touch that
huge amount of media data.

173
00:08:02,876 --> 00:08:04,706 A:middle
However, as you can imagine,

174
00:08:04,706 --> 00:08:08,076 A:middle
there's a certain
fragility involved here.

175
00:08:08,476 --> 00:08:11,906 A:middle
Why? Because I'm referring
to data, and if the data

176
00:08:11,906 --> 00:08:13,776 A:middle
that I am referring
to happens to move

177
00:08:14,026 --> 00:08:16,306 A:middle
or gets deleted,
I am out of luck.

178
00:08:16,406 --> 00:08:18,486 A:middle
I can't play my presentation
anymore.

179
00:08:18,876 --> 00:08:20,796 A:middle
Now, it's possible to reduce

180
00:08:20,796 --> 00:08:22,556 A:middle
that fragility in
a couple of ways.

181
00:08:22,986 --> 00:08:26,096 A:middle
Primarily by using relative URLs

182
00:08:26,096 --> 00:08:29,186 A:middle
when I make these sample
references, and we'll see how

183
00:08:29,186 --> 00:08:30,416 A:middle
to do that in a little bit.

184
00:08:30,806 --> 00:08:34,765 A:middle
But at the end of the
day, you are going to want

185
00:08:34,765 --> 00:08:36,686 A:middle
to have what's called
a self-contained movie.

186
00:08:36,686 --> 00:08:39,515 A:middle
If you want to give it to
a friend to view or post it

187
00:08:39,515 --> 00:08:40,686 A:middle
for delivery on the Web.

188
00:08:41,086 --> 00:08:42,316 A:middle
And when you need to do that,

189
00:08:42,616 --> 00:08:45,046 A:middle
you can just run
your mutable movie

190
00:08:45,046 --> 00:08:47,046 A:middle
through an AVAssetExportSession

191
00:08:47,376 --> 00:08:49,236 A:middle
to get a nice self-contained
file.

192
00:08:49,796 --> 00:08:53,086 A:middle
Okay. So let's look at
the movie editing API

193
00:08:53,086 --> 00:08:54,236 A:middle
that we are introducing.

194
00:08:54,836 --> 00:09:00,376 A:middle
At the immutable level -- so
AVMovie is an immutable subclass

195

196
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

197
00:08:54,836 --> 00:09:00,376 A:middle
At the immutable level -- so
AVMovie is an immutable subclass

198
00:09:00,376 --> 00:09:03,956 A:middle
of AVAsset -- we can actually do
some interesting things already.

199
00:09:04,186 --> 00:09:06,296 A:middle
We can inspect the movie.

200
00:09:06,386 --> 00:09:08,206 A:middle
We can get what's
called the movie header.

201
00:09:08,656 --> 00:09:10,826 A:middle
And we can write this movie
header into a new file.

202
00:09:12,736 --> 00:09:16,286 A:middle
By movie header, I just
mean the file type box

203
00:09:16,286 --> 00:09:19,096 A:middle
and the movie box together,
none of the sample data.

204
00:09:19,726 --> 00:09:24,086 A:middle
So how do we initialize
an AVMovie?

205
00:09:24,086 --> 00:09:27,816 A:middle
If you have initialized an
AVRL, you know how to do it.

206
00:09:27,816 --> 00:09:30,606 A:middle
You give us a URL, and we
give you back an AVMovie.

207
00:09:31,046 --> 00:09:35,856 A:middle
You can also, if you
have a movie header, say,

208
00:09:35,856 --> 00:09:38,406 A:middle
on the paste board,
you can access that

209
00:09:38,786 --> 00:09:41,146 A:middle
and create a movie
from a block of data.

210
00:09:41,146 --> 00:09:44,016 A:middle
We are not actually going
to talk about this anymore

211
00:09:44,016 --> 00:09:45,566 A:middle
in this talk, but if you look

212
00:09:45,566 --> 00:09:48,636 A:middle
at our sample code package
called AVMovieEditor,

213
00:09:48,906 --> 00:09:51,786 A:middle
you will see very nicely
how you can put stuff

214
00:09:51,786 --> 00:09:53,726 A:middle
and take stuff off
of the paste board.

215
00:09:54,266 --> 00:09:57,516 A:middle
So here is how easy it is

216
00:09:57,516 --> 00:09:59,456 A:middle
to create a sample
reference movie file.

217

218
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

219
00:10:00,026 --> 00:10:04,326 A:middle
We'll open a URL as an AVMovie.

220
00:10:04,456 --> 00:10:11,806 A:middle
Sorry. Then we call the right --

221
00:10:11,806 --> 00:10:14,506 A:middle
an indication of the type
of file we want to create,

222
00:10:14,896 --> 00:10:16,076 A:middle
and then some options.

223
00:10:16,616 --> 00:10:18,326 A:middle
Now, in this case, the option

224
00:10:18,326 --> 00:10:20,716 A:middle
that we've specified
is truncate destination

225
00:10:20,716 --> 00:10:21,886 A:middle
to movie header only.

226
00:10:22,576 --> 00:10:26,046 A:middle
Essentially, this means if
there's any data already

227
00:10:26,046 --> 00:10:29,126 A:middle
at that output URL, it's
going to get blown away

228
00:10:29,126 --> 00:10:30,286 A:middle
and what's going to end up in

229
00:10:30,286 --> 00:10:32,116 A:middle
that file is simply
the movie header.

230
00:10:33,426 --> 00:10:36,056 A:middle
Now, it's possible to
pass in a different option

231
00:10:36,296 --> 00:10:39,006 A:middle
and not blow away any data
that might be in that file,

232
00:10:39,056 --> 00:10:42,136 A:middle
so that would be the add movie
header to destination option.

233
00:10:42,136 --> 00:10:49,596 A:middle
So let's move to
the mutable subclass

234
00:10:49,596 --> 00:10:51,536 A:middle
of AVMovie, AVMutableMovie.

235
00:10:52,166 --> 00:10:55,466 A:middle
This provides editing
methods that aus

236
00:10:55,466 --> 00:11:00,236 A:middle
to perform range-based movie
editing, add and remove tracks,

237

238
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

239
00:10:55,466 --> 00:11:00,236 A:middle
to perform range-based movie
editing, add and remove tracks,

240
00:11:00,766 --> 00:11:02,576 A:middle
add or modify movie metadata.

241
00:11:03,166 --> 00:11:06,806 A:middle
So how do we initialize
an AVMutableMovie?

242
00:11:06,806 --> 00:11:09,166 A:middle
Pretty much the same way
we initialize an AVMovie.

243
00:11:09,166 --> 00:11:12,326 A:middle
We will pass it a URL,
but in this case we need

244
00:11:12,326 --> 00:11:14,336 A:middle
to be able toened had ale
any errors that might occur.

245
00:11:15,636 --> 00:11:18,966 A:middle
It's also possible to create
an AVMutableMovie from scratch.

246
00:11:19,196 --> 00:11:22,846 A:middle
So this line of code gives us
back an empty AVMutableMovie

247
00:11:23,226 --> 00:11:26,246 A:middle
that we are going to want to
add tracks to and then some data

248
00:11:26,246 --> 00:11:27,866 A:middle
to the tracks and so forth.

249
00:11:29,516 --> 00:11:32,606 A:middle
These are the segment
editing methods available

250
00:11:32,606 --> 00:11:33,786 A:middle
on AVMutableMovie.

251
00:11:33,786 --> 00:11:36,126 A:middle
If you have worked with
AVMutable composition,

252
00:11:36,126 --> 00:11:39,646 A:middle
this is familiar because
they are, in fact,

253
00:11:39,646 --> 00:11:45,136 A:middle
identical with one exception,

254
00:11:45,136 --> 00:11:48,936 A:middle
which is the insert time range
method takes an additional

255
00:11:48,936 --> 00:11:53,866 A:middle
parameter that indicates whether
you want to copy the sample data

256
00:11:53,866 --> 00:11:56,906 A:middle
into the target or just
copy sample references.

257
00:11:57,396 --> 00:12:06,076 A:middle
Now, if you copy sample data
into the target mutable movie,

258

259
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

260
00:11:57,396 --> 00:12:06,076 A:middle
Now, if you copy sample data
into the target mutable movie,

261
00:12:06,566 --> 00:12:09,446 A:middle
you need to tell it where
to write that sample data.

262
00:12:09,576 --> 00:12:11,266 A:middle
It does nothing by default.

263
00:12:11,796 --> 00:12:13,626 A:middle
It's not going to
write it into the file

264
00:12:13,626 --> 00:12:16,186 A:middle
that the movie box is
located in, for instance.

265
00:12:16,586 --> 00:12:18,696 A:middle
So you have to explicitly
specify

266
00:12:19,026 --> 00:12:21,466 A:middle
where you want any new
sample data that's written

267
00:12:21,466 --> 00:12:23,826 A:middle
into this movie to be put.

268
00:12:24,186 --> 00:12:27,846 A:middle
And you do that by specifying
the default media data storage

269
00:12:27,846 --> 00:12:29,926 A:middle
property of the mutable movie.

270
00:12:30,426 --> 00:12:34,676 A:middle
And this is where this
AVMediaDataStorage class comes

271
00:12:34,676 --> 00:12:35,246 A:middle
into play.

272
00:12:35,776 --> 00:12:40,716 A:middle
Again, it just simply
wraps a URL at this point.

273
00:12:40,896 --> 00:12:43,796 A:middle
There are methods for
creating and removing tracks,

274
00:12:43,796 --> 00:12:45,096 A:middle
and you see to create a track,

275
00:12:45,096 --> 00:12:47,136 A:middle
we have to say what
type of track we want.

276
00:12:47,136 --> 00:12:48,106 A:middle
Do we want a video track,

277
00:12:48,106 --> 00:12:50,106 A:middle
do we want an audio
track, and so forth.

278
00:12:50,956 --> 00:12:53,666 A:middle
And if we like, if we have an
existing track that we want

279
00:12:53,666 --> 00:12:57,106 A:middle
to model this new one on,
we can pass it in as an --

280
00:12:57,286 --> 00:13:00,276 A:middle
as a parameter and say take
the relevant properties

281

282
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

283
00:12:57,286 --> 00:13:00,276 A:middle
as a parameter and say take
the relevant properties

284
00:13:00,276 --> 00:13:02,176 A:middle
from that existing
track and use those.

285
00:13:02,176 --> 00:13:07,576 A:middle
So here's a simple
little case study.

286
00:13:08,366 --> 00:13:11,026 A:middle
To update an existing movie
file, we could open it

287
00:13:11,026 --> 00:13:14,576 A:middle
up from a URL, do some edits
using the methods we've just

288
00:13:14,576 --> 00:13:18,946 A:middle
seen, and then we can use the
right movie header to URL method

289
00:13:19,296 --> 00:13:22,176 A:middle
to write the movie header
back into that same file.

290
00:13:22,246 --> 00:13:24,526 A:middle
This is what's known
as in-place editing.

291
00:13:25,026 --> 00:13:27,536 A:middle
So here we haven't
moved any sample data.

292
00:13:28,196 --> 00:13:30,856 A:middle
All we've done is
tweak the movie box

293
00:13:31,086 --> 00:13:32,636 A:middle
and put it back into
the same file.

294
00:13:32,636 --> 00:13:37,056 A:middle
So let's talk about
the track editing API.

295
00:13:37,616 --> 00:13:39,836 A:middle
This allows us to
modify tracks that are

296
00:13:39,836 --> 00:13:41,166 A:middle
in a QuickTime movie file,

297
00:13:41,616 --> 00:13:44,616 A:middle
and we have range-based
track editing,

298
00:13:44,616 --> 00:13:46,316 A:middle
just like we saw
at the movie level.

299
00:13:46,916 --> 00:13:50,866 A:middle
We can also set associations
between tracks, and we can add

300
00:13:50,866 --> 00:13:52,296 A:middle
or modify track metadata.

301
00:13:52,876 --> 00:13:55,896 A:middle
So here are the segment
editing methods,

302
00:13:55,896 --> 00:14:00,576 A:middle
and they should look familiar
because we've just seen them.

303

304
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

305
00:13:55,896 --> 00:14:00,576 A:middle
and they should look familiar
because we've just seen them.

306
00:14:00,786 --> 00:14:01,906 A:middle
At the movie level.

307
00:14:01,906 --> 00:14:05,416 A:middle
The only difference being that
instead of insert time range

308
00:14:05,416 --> 00:14:09,186 A:middle
of asset, we have insert
time range of track.

309
00:14:09,856 --> 00:14:12,986 A:middle
And again, when we do insert
time range, we have to specify,

310
00:14:12,986 --> 00:14:15,586 A:middle
do you want to copy the sample
data, or do you just want

311
00:14:15,586 --> 00:14:17,006 A:middle
to put in sample references.

312
00:14:17,356 --> 00:14:20,206 A:middle
And if you copy the sample
data, the track has to know

313
00:14:20,206 --> 00:14:21,936 A:middle
where that sample
data is going to go,

314
00:14:21,936 --> 00:14:25,716 A:middle
and we do that by setting the
media data storage property

315
00:14:26,046 --> 00:14:29,486 A:middle
of that track using exactly
the same class we used

316
00:14:29,486 --> 00:14:30,296 A:middle
at the movie level.

317
00:14:30,866 --> 00:14:33,756 A:middle
So here is another case study.

318
00:14:34,106 --> 00:14:35,586 A:middle
Suppose there's a
little bit of a clip

319
00:14:35,666 --> 00:14:36,906 A:middle
that I want to silence out.

320
00:14:36,906 --> 00:14:40,376 A:middle
Maybe there's some unfortunate
language in that clip.

321
00:14:40,486 --> 00:14:44,986 A:middle
I could do it it quite simply
by finding the first audio track

322
00:14:44,986 --> 00:14:49,486 A:middle
in the movie; define a time
range, which is the range I want

323
00:14:49,486 --> 00:14:52,966 A:middle
to silence; remove
that time range;

324
00:14:53,246 --> 00:14:56,206 A:middle
and then insert an empty
time range at that same spot.

325
00:14:56,756 --> 00:15:00,066 A:middle
The net effect of this code
is to have an empty segment

326

327
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

328
00:14:56,756 --> 00:15:00,066 A:middle
The net effect of this code
is to have an empty segment

329
00:15:00,406 --> 00:15:05,096 A:middle
where there used to be some
offensive language, say.

330
00:15:05,336 --> 00:15:07,436 A:middle
Working with track
associations is very simple.

331
00:15:07,436 --> 00:15:11,366 A:middle
You can add a track association
or remove a track association.

332
00:15:11,366 --> 00:15:14,236 A:middle
We will see this in use later.

333
00:15:14,786 --> 00:15:19,756 A:middle
And I said I would tell you
how to use relative URLs

334
00:15:19,756 --> 00:15:22,966 A:middle
when you copy sample
data into your track,

335
00:15:23,476 --> 00:15:24,646 A:middle
and you do it like this.

336
00:15:24,936 --> 00:15:29,046 A:middle
You open. For each track,

337
00:15:29,046 --> 00:15:34,726 A:middle
we will set sample
reference base URL property

338
00:15:35,286 --> 00:15:39,026 A:middle
to some common parent of the
movie that contains the movie --

339
00:15:39,026 --> 00:15:41,696 A:middle
file that contains the
movie box and the files

340
00:15:41,696 --> 00:15:43,736 A:middle
that contain all the media data.

341
00:15:45,976 --> 00:15:46,576 A:middle
All right.

342
00:15:46,576 --> 00:15:51,286 A:middle
So let's move on to
this personal project

343
00:15:51,286 --> 00:15:53,836 A:middle
that I talk about, and I
want to call it A Study

344
00:15:53,836 --> 00:15:58,496 A:middle
in Scarlet (and Gray)
apologies to Conan Doyle.

345
00:15:58,496 --> 00:16:01,756 A:middle
Let's jump back in time to 1980.

346

347
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

348
00:15:58,496 --> 00:16:01,756 A:middle
Let's jump back in time to 1980.

349
00:16:01,756 --> 00:16:02,406 A:middle
What are we talking?

350
00:16:02,406 --> 00:16:03,646 A:middle
35 years ago.

351
00:16:04,336 --> 00:16:07,006 A:middle
At that time, I was a
graduate student across the bay

352
00:16:07,006 --> 00:16:10,796 A:middle
at Berkeley, and I needed a
way to blow off some energy,

353
00:16:10,796 --> 00:16:14,876 A:middle
so I went out and bought a pair
of skates, and I discovered

354
00:16:14,876 --> 00:16:17,046 A:middle
that Berkeley is a great
place to be a skater

355
00:16:17,046 --> 00:16:19,396 A:middle
because it's got these
really nice hills.

356
00:16:20,826 --> 00:16:22,816 A:middle
And I really enjoyed that.

357
00:16:22,816 --> 00:16:27,036 A:middle
So I kept finding higher
and higher hills to climb up

358
00:16:27,036 --> 00:16:28,526 A:middle
and then go flying down.

359
00:16:29,296 --> 00:16:31,956 A:middle
So here in 1984, you
can see me at the top

360
00:16:31,956 --> 00:16:33,996 A:middle
of Claremont avenue in Oakland.

361
00:16:34,606 --> 00:16:38,946 A:middle
In the distance, you can see
San Francisco, just this side

362
00:16:38,946 --> 00:16:42,606 A:middle
of the bay, we have Emeryville,
and we have this wonderful,

363
00:16:42,606 --> 00:16:44,776 A:middle
almost looks like a
ski run in front of me.

364
00:16:44,996 --> 00:16:48,476 A:middle
I am not quite sure what
the hand up is doing.

365
00:16:48,476 --> 00:16:50,256 A:middle
Maybe it's the sort
of we who are

366
00:16:50,256 --> 00:16:54,026 A:middle
about to die salute you
thing, and I didn't die.

367
00:16:54,106 --> 00:16:54,646 A:middle
It's okay.

368
00:16:56,726 --> 00:16:58,926 A:middle
[Laughter] Well, what I
did in order to keep track

369
00:16:58,926 --> 00:17:01,116 A:middle
of where I was, I went out
and I bought a street map,

370

371
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

372
00:16:58,926 --> 00:17:01,116 A:middle
of where I was, I went out
and I bought a street map,

373
00:17:01,976 --> 00:17:03,826 A:middle
and I got myself a
yellow highlighter,

374
00:17:04,356 --> 00:17:07,915 A:middle
and I started marking off on my
map exactly where I had been,

375
00:17:08,705 --> 00:17:10,586 A:middle
which hills were
particularly good.

376
00:17:11,516 --> 00:17:14,185 A:middle
Well, if you are like me,
that's a really bad thing

377
00:17:14,185 --> 00:17:16,366 A:middle
to start doing because
you're going to want to end

378
00:17:16,366 --> 00:17:18,526 A:middle
up coloring in the entire map.

379
00:17:19,006 --> 00:17:22,786 A:middle
And so about 2000 -- sorry.

380
00:17:22,786 --> 00:17:27,046 A:middle
About 1985, I came
up with a project

381
00:17:27,086 --> 00:17:29,976 A:middle
that I called Tim's Radical
Inline Skate Tour of Oakland,

382
00:17:30,566 --> 00:17:34,866 A:middle
or TRISTO, and the
goal was really simple,

383
00:17:34,866 --> 00:17:36,776 A:middle
to skate every street
in Oakland,

384
00:17:36,776 --> 00:17:38,496 A:middle
the entire length of it.

385
00:17:38,806 --> 00:17:42,866 A:middle
This continued from
1985 until about 2005,

386
00:17:42,866 --> 00:17:44,566 A:middle
so ten years ago, and I made it.

387
00:17:45,556 --> 00:17:45,946 A:middle
Okay?

388
00:17:46,016 --> 00:17:47,876 A:middle
[Applause]

389
00:17:47,876 --> 00:17:48,226 A:middle
Thank you.

390
00:17:50,996 --> 00:17:54,006 A:middle
Oakland has about 800 miles of
roadways that you would have

391
00:17:54,006 --> 00:17:55,876 A:middle
to skate in order
to accomplish this.

392
00:17:57,026 --> 00:18:01,256 A:middle
Now, when I was done in
2005, I had no location data.

393

394
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

395
00:17:57,026 --> 00:18:01,256 A:middle
Now, when I was done in
2005, I had no location data.

396
00:18:01,256 --> 00:18:03,286 A:middle
GPS hadn't been invented
when I started,

397
00:18:03,636 --> 00:18:05,256 A:middle
and it certainly
wasn't available.

398
00:18:05,676 --> 00:18:08,846 A:middle
Actually, I did have location
data because if you open

399
00:18:08,846 --> 00:18:16,026 A:middle
up my map, you will see that
it is right side up all yellow,

400
00:18:16,116 --> 00:18:18,876 A:middle
not just -- but Alameda,
Piedmont,

401
00:18:19,036 --> 00:18:21,246 A:middle
Emeryville, the whole
nine yards.

402
00:18:23,226 --> 00:18:26,886 A:middle
I also had no video.

403
00:18:26,916 --> 00:18:29,576 A:middle
If you remember back
to that time, I mean,

404
00:18:29,576 --> 00:18:32,606 A:middle
the camera you would be
carrying in 1985 would be clunky

405
00:18:32,606 --> 00:18:34,356 A:middle
and fragile, and you just
wouldn't want to have it

406
00:18:34,356 --> 00:18:35,626 A:middle
with you when you are
out there skating.

407
00:18:36,226 --> 00:18:39,256 A:middle
So when I finished
this, I really --

408
00:18:39,336 --> 00:18:41,376 A:middle
this is a wacko project,
I admit that,

409
00:18:42,106 --> 00:18:45,696 A:middle
and I made absolutely no effort
to tell anybody about this.

410
00:18:46,186 --> 00:18:51,576 A:middle
Unfortunately, the San Francisco
chronicle learned of this feat,

411
00:18:51,576 --> 00:18:54,096 A:middle
I guess, and wrote a nice
little newspaper article,

412
00:18:54,096 --> 00:18:55,446 A:middle
one of these human
interest stories.

413
00:18:56,996 --> 00:18:59,346 A:middle
The Oakland City
Council learned about it,

414
00:18:59,346 --> 00:19:02,466 A:middle
they passed a resolution
praising the extraordinary

415

416
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

417
00:18:59,346 --> 00:19:02,466 A:middle
they passed a resolution
praising the extraordinary

418
00:19:02,466 --> 00:19:05,856 A:middle
physical accomplishment --
that's their words, not mine.

419
00:19:06,796 --> 00:19:10,476 A:middle
A couple of filmmakers
in Oakland heard about it

420
00:19:10,796 --> 00:19:12,496 A:middle
and spent literally years off

421
00:19:12,496 --> 00:19:15,346 A:middle
and on making a nice little
documentary about this project,

422
00:19:16,006 --> 00:19:19,616 A:middle
which came out about a year ago
and has been making the rounds

423
00:19:19,616 --> 00:19:21,356 A:middle
of independent theaters
in the Bay area.

424
00:19:21,356 --> 00:19:25,666 A:middle
Just completely wacko.

425
00:19:26,176 --> 00:19:30,826 A:middle
So about a couple of years
after I finished this project,

426
00:19:31,316 --> 00:19:35,206 A:middle
I started spending some time on
the east coast, in particular

427
00:19:35,206 --> 00:19:37,486 A:middle
in the area of Boston,
Massachusetts,

428
00:19:38,016 --> 00:19:40,666 A:middle
and even more particular,
in Cambridge.

429
00:19:40,936 --> 00:19:44,016 A:middle
And I thought, all right, let's
take this thing on the road.

430
00:19:44,516 --> 00:19:48,386 A:middle
I spent a few years skating
Cambridge and Somerville,

431
00:19:48,696 --> 00:19:51,846 A:middle
and then finally the idea
for TRISTO Boston was born.

432
00:19:52,466 --> 00:19:53,336 A:middle
Same idea.

433
00:19:53,336 --> 00:19:56,546 A:middle
Skate every street in
the city of Boston.

434
00:19:57,616 --> 00:20:00,976 A:middle
So this began about 2011.

435

436
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

437
00:19:57,616 --> 00:20:00,976 A:middle
So this began about 2011.

438
00:20:01,606 --> 00:20:03,256 A:middle
I looked at a map, and I
figured it would take me

439
00:20:03,256 --> 00:20:05,236 A:middle
about five years
to complete this.

440
00:20:06,176 --> 00:20:08,436 A:middle
Well, we had a couple
mild winters in there.

441
00:20:08,716 --> 00:20:10,196 A:middle
It's about the same
size as Oakland.

442
00:20:10,956 --> 00:20:14,226 A:middle
And I was able to complete this
in about two and a half years,

443
00:20:14,226 --> 00:20:19,206 A:middle
so in May 2013, I
finished TRISTO Boston.

444
00:20:19,296 --> 00:20:24,436 A:middle
Now, this time I was prepared
because as I was skating,

445
00:20:24,786 --> 00:20:27,366 A:middle
I had one of those sports
action cameras up on the top

446
00:20:27,366 --> 00:20:32,046 A:middle
of my helmet, and I had
a GPS app for my iPhone.

447
00:20:32,676 --> 00:20:33,766 A:middle
And so when I ended up,

448
00:20:33,766 --> 00:20:40,586 A:middle
I had 490 MPEG-4 files
straight off the camera covering

449
00:20:40,586 --> 00:20:43,216 A:middle
about 200 different
skates for a total

450
00:20:43,216 --> 00:20:46,416 A:middle
of about a terabyte
and a half of data.

451
00:20:47,446 --> 00:20:51,026 A:middle
I also had GPS data in
the form of GPX files --

452
00:20:51,026 --> 00:20:53,456 A:middle
that's sort of an XML
version of location data --

453
00:20:53,456 --> 00:20:54,376 A:middle
we will see one later --

454
00:20:55,266 --> 00:20:57,876 A:middle
for about 150 megabytes
worth of data.

455
00:20:58,486 --> 00:21:03,176 A:middle
So just to get an idea of
what these movies look like,

456

457
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

458
00:20:58,486 --> 00:21:03,176 A:middle
So just to get an idea of
what these movies look like,

459
00:21:03,176 --> 00:21:04,416 A:middle
let's just look at one.

460
00:21:05,606 --> 00:21:08,496 A:middle
So these are movies
straight off the camera.

461
00:21:08,496 --> 00:21:09,946 A:middle
The only thing I have
done is rename them

462
00:21:09,946 --> 00:21:10,936 A:middle
so that it's got the date

463
00:21:10,936 --> 00:21:13,836 A:middle
and title making it
easy for me to find.

464
00:21:15,306 --> 00:21:17,396 A:middle
So we will open these
up in QuickTime Player.

465
00:21:17,646 --> 00:21:20,476 A:middle
There's the second one, so
that continues at the end

466
00:21:20,476 --> 00:21:24,186 A:middle
of the first one, so we will
select the first movie here.

467
00:21:24,646 --> 00:21:26,626 A:middle
We can see it's a
bright, sunny day.

468
00:21:27,266 --> 00:21:28,956 A:middle
It's late November.

469
00:21:29,296 --> 00:21:30,466 A:middle
It's a weekday.

470
00:21:31,126 --> 00:21:32,246 A:middle
And let's just roll this.

471
00:21:32,246 --> 00:21:35,136 A:middle
We see it's the fall because
there's leaves on the ground.

472
00:21:35,746 --> 00:21:37,416 A:middle
If we had the audio,
we would hear

473
00:21:37,416 --> 00:21:39,806 A:middle
that it's actually
quite windy on this day.

474
00:21:40,396 --> 00:21:42,976 A:middle
And there's something
strange here, though.

475
00:21:43,186 --> 00:21:44,706 A:middle
There's nobody on the street.

476
00:21:44,936 --> 00:21:46,276 A:middle
There's no pedestrians.

477
00:21:46,746 --> 00:21:48,226 A:middle
Let's jump ahead a
little bit again.

478
00:21:49,096 --> 00:21:50,456 A:middle
No pedestrians.

479
00:21:50,456 --> 00:21:51,356 A:middle
There's some cars.

480
00:21:51,876 --> 00:21:53,826 A:middle
Here I am at Longwood
Medical District.

481
00:21:53,926 --> 00:21:56,226 A:middle
This is a heavily
trafficked area.

482
00:21:56,366 --> 00:21:56,996 A:middle
Nobody there.

483
00:21:57,246 --> 00:21:58,756 A:middle
Here's a commercial district.

484
00:21:59,616 --> 00:22:01,136 A:middle
Nobody. It's like a ghost town.

485

486
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

487
00:21:59,616 --> 00:22:01,136 A:middle
Nobody. It's like a ghost town.

488
00:22:01,316 --> 00:22:02,486 A:middle
So what's going on?

489
00:22:03,436 --> 00:22:06,376 A:middle
Well, we'll solve
that problem later.

490
00:22:08,196 --> 00:22:10,646 A:middle
So what I've got,
basically, is a hay stack

491
00:22:11,066 --> 00:22:12,236 A:middle
and a bunch of needles.

492
00:22:12,236 --> 00:22:14,456 A:middle
I've got 500 hours of video.

493
00:22:15,036 --> 00:22:19,886 A:middle
Even if 99% of it is junk,
that's still five full hours

494
00:22:19,886 --> 00:22:21,836 A:middle
of interesting video
that I'd like to find.

495
00:22:23,386 --> 00:22:24,316 A:middle
Part of the problem, though,

496
00:22:24,316 --> 00:22:26,016 A:middle
is I don't even know
what the needles look

497
00:22:26,016 --> 00:22:28,326 A:middle
like because I don't
know what's important

498
00:22:28,546 --> 00:22:30,746 A:middle
in these 500 hours of video.

499
00:22:32,846 --> 00:22:35,756 A:middle
Well, I do know some things
that I'd really love to look at,

500
00:22:35,756 --> 00:22:38,506 A:middle
and here is sort of a
montage of some of these.

501
00:22:48,256 --> 00:22:49,266 A:middle
Snow, really?

502
00:22:49,306 --> 00:22:49,976 A:middle
I mean, come on.

503
00:22:55,116 --> 00:22:56,496 A:middle
Like, I didn't see that pothole?

504
00:22:57,516 --> 00:23:04,576 A:middle
[Laughter]

505

506
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

507
00:22:57,516 --> 00:23:04,576 A:middle
[Laughter]

508
00:23:05,076 --> 00:23:07,886 A:middle
Now, that one's my favorite,
because as you can see,

509
00:23:07,886 --> 00:23:11,496 A:middle
I go down, I kind of roll over,
I get back and keep on skating.

510
00:23:11,496 --> 00:23:13,976 A:middle
You know, if it wasn't
as -- thank you.

511
00:23:14,516 --> 00:23:18,276 A:middle
[Applause]

512
00:23:18,776 --> 00:23:20,916 A:middle
Now, I actually had to
pay somebody to weed --

513
00:23:20,916 --> 00:23:25,256 A:middle
to look through about
1/50 of all of my video

514
00:23:26,186 --> 00:23:27,646 A:middle
to get these six clips.

515
00:23:27,866 --> 00:23:30,626 A:middle
So in theory, there's 300

516
00:23:30,626 --> 00:23:33,666 A:middle
of these wonderful falls
somewhere in that hay stack.

517
00:23:34,646 --> 00:23:36,756 A:middle
So at about, you know,
five seconds per fall,

518
00:23:36,756 --> 00:23:39,416 A:middle
we are talking 25
minutes of this stuff,

519
00:23:39,416 --> 00:23:40,976 A:middle
which would be really
fun to watch.

520
00:23:41,061 --> 00:23:43,061 A:middle
[Laughter]

521
00:23:43,106 --> 00:23:45,456 A:middle
So here's what I want to
do with all this data.

522
00:23:45,686 --> 00:23:48,396 A:middle
I've got a terabyte and a
half of video data that I want

523
00:23:48,396 --> 00:23:49,616 A:middle
to somehow do something with.

524
00:23:49,616 --> 00:23:51,086 A:middle
I want to find those needles.

525
00:23:51,466 --> 00:23:55,886 A:middle
So the first step is going to
be to combine the various files

526
00:23:55,886 --> 00:23:57,976 A:middle
that came off the
camera for one skate

527
00:23:58,436 --> 00:24:02,306 A:middle
into a sample reference movie
file so that I can just open it

528

529
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

530
00:23:58,436 --> 00:24:02,306 A:middle
into a sample reference movie
file so that I can just open it

531
00:24:02,306 --> 00:24:05,246 A:middle
and edit it and not have to
worry about the camera files.

532
00:24:06,436 --> 00:24:09,276 A:middle
The second thing I want to
do is add indexing metadata

533
00:24:09,516 --> 00:24:12,396 A:middle
as movie metadata.

534
00:24:12,936 --> 00:24:15,466 A:middle
So I want to go in and
mark in the file, okay,

535
00:24:15,466 --> 00:24:18,386 A:middle
this is where I start to fall,
and this is the end of the fall.

536
00:24:18,736 --> 00:24:20,756 A:middle
Or this is where
dogs are chasing me,

537
00:24:20,756 --> 00:24:22,236 A:middle
and this is where
they finally figured

538
00:24:22,236 --> 00:24:24,206 A:middle
out they are not
going to get me.

539
00:24:24,206 --> 00:24:27,096 A:middle
Or this is where I am talking
to a law enforcement officer,

540
00:24:27,096 --> 00:24:28,316 A:middle
and that just keeps going.

541
00:24:29,806 --> 00:24:32,786 A:middle
So I'd like to index all
this stuff so that it's easy

542
00:24:32,786 --> 00:24:36,006 A:middle
to search and find all these
needles, as I call them.

543
00:24:36,006 --> 00:24:38,546 A:middle
I want to add GPS data.

544
00:24:38,546 --> 00:24:41,306 A:middle
I have all that location data
I haven't done anything with.

545
00:24:41,306 --> 00:24:43,176 A:middle
I want to add it to the
file, and I am going to do

546
00:24:43,176 --> 00:24:45,376 A:middle
that as what's called
a timed metadata track.

547
00:24:46,836 --> 00:24:50,926 A:middle
And the key is I want to do all
of this without modifying any

548
00:24:50,926 --> 00:24:52,446 A:middle
of the original camera files,

549
00:24:52,886 --> 00:24:57,716 A:middle
and by minimizing any data
copying that I need to do.

550
00:24:57,716 --> 00:24:58,946 A:middle
Okay. How are we
going to do that?

551
00:24:59,376 --> 00:25:03,016 A:middle
Well, AVMovie and AVMutableMovie
give us the answer.

552

553
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

554
00:24:59,376 --> 00:25:03,016 A:middle
Well, AVMovie and AVMutableMovie
give us the answer.

555
00:25:03,926 --> 00:25:07,036 A:middle
The solution to the first
issue is very simple.

556
00:25:07,036 --> 00:25:09,746 A:middle
I am going to take those
camera files, and I am going

557
00:25:09,746 --> 00:25:12,746 A:middle
to create a sample reference
movie file that points

558
00:25:12,786 --> 00:25:14,756 A:middle
to the data in those
two original files.

559
00:25:15,446 --> 00:25:17,926 A:middle
Very straightforward,
standard use

560
00:25:17,926 --> 00:25:19,776 A:middle
of sample reference movie files.

561
00:25:21,096 --> 00:25:24,516 A:middle
The solution for the second
step is just to add a little bit

562
00:25:24,516 --> 00:25:27,696 A:middle
of extra custom metadata
to my movie box.

563
00:25:28,206 --> 00:25:33,196 A:middle
The third step is to add
some actual media data

564
00:25:33,466 --> 00:25:37,656 A:middle
into my new sample
reference movie file.

565
00:25:38,236 --> 00:25:41,036 A:middle
And that media data, even though
it's called timed metadata,

566
00:25:41,036 --> 00:25:44,496 A:middle
it's stored as media data or
sample data, and it just goes

567
00:25:44,496 --> 00:25:46,116 A:middle
into a new track in the file.

568
00:25:47,346 --> 00:25:50,686 A:middle
So that's the way I want
to approach this issue.

569
00:25:51,516 --> 00:25:53,336 A:middle
So the first step is
actually quite simple.

570
00:25:53,856 --> 00:25:58,036 A:middle
We'll open the first
movie as a mutable movie,

571
00:25:58,356 --> 00:25:59,536 A:middle
and we'll open the second

572
00:25:59,536 --> 00:26:02,646 A:middle
and any subsequent
movies as just URL assets.

573

574
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

575
00:25:59,536 --> 00:26:02,646 A:middle
and any subsequent
movies as just URL assets.

576
00:26:03,666 --> 00:26:07,516 A:middle
We'll define the range in the
asset that we want to insert,

577
00:26:07,516 --> 00:26:10,126 A:middle
and that's just the
entire asset duration.

578
00:26:10,826 --> 00:26:15,636 A:middle
We will actually insert it into
the mutable movie at the end

579
00:26:15,636 --> 00:26:18,966 A:middle
of the mutable movie, and
notice we say don't copy the

580
00:26:18,966 --> 00:26:19,656 A:middle
sample data.

581
00:26:19,776 --> 00:26:21,826 A:middle
I just want to end up
with sample references.

582
00:26:22,656 --> 00:26:26,656 A:middle
Finally, all we have to do
is write a new movie header

583
00:26:26,656 --> 00:26:32,026 A:middle
out to a new file, and we have
then created a sample reference

584
00:26:32,026 --> 00:26:34,016 A:middle
movie file that points
to the data

585
00:26:34,016 --> 00:26:35,706 A:middle
in the two original
camera files.

586
00:26:37,476 --> 00:26:39,046 A:middle
So let's look at some demos

587
00:26:39,436 --> 00:26:41,436 A:middle
of how I solve the
second and third one.

588
00:26:41,916 --> 00:26:45,096 A:middle
Normally this slide would just
read demos, but I am a sucker

589
00:26:45,096 --> 00:26:52,616 A:middle
for a good palindrome, and
I just couldn't waste it.

590
00:26:52,616 --> 00:26:55,276 A:middle
Alvin is a sort of acronym

591
00:26:55,276 --> 00:26:58,276 A:middle
for AVFoundation-based
linear indexer.

592
00:26:59,346 --> 00:27:03,836 A:middle
Its job is to do the
indexing I talked about,

593

594
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

595
00:26:59,346 --> 00:27:03,836 A:middle
Its job is to do the
indexing I talked about,

596
00:27:04,126 --> 00:27:07,536 A:middle
but also get the location
data into my file.

597
00:27:08,246 --> 00:27:09,976 A:middle
This is what the UI looks like.

598
00:27:10,466 --> 00:27:14,116 A:middle
I've got a movie view on the
left, I've got a map view

599
00:27:14,116 --> 00:27:18,136 A:middle
on the right, and down below you
can see I've got some display

600
00:27:18,136 --> 00:27:20,566 A:middle
areas where I am going to
be displaying information

601
00:27:20,566 --> 00:27:22,846 A:middle
that I glean about this skate.

602
00:27:23,796 --> 00:27:27,126 A:middle
So let's go ahead and
open up a movie file.

603
00:27:27,126 --> 00:27:31,256 A:middle
And this is the sample reference
movie file that I just created.

604
00:27:32,056 --> 00:27:32,876 A:middle
That opens up there.

605
00:27:32,876 --> 00:27:34,566 A:middle
I am going to load a GPX file.

606
00:27:34,566 --> 00:27:38,486 A:middle
I will go out and select
the appropriate GPS file.

607
00:27:40,356 --> 00:27:42,146 A:middle
Now, when I open this file,

608
00:27:42,466 --> 00:27:44,046 A:middle
some of the data's
going to be filled in.

609
00:27:44,046 --> 00:27:46,136 A:middle
It's going to figure
out how long this was.

610
00:27:46,826 --> 00:27:50,706 A:middle
Okay? So let's -- I've got it
so I can expand my map view

611
00:27:50,706 --> 00:27:51,996 A:middle
to make it clear where we are.

612
00:27:51,996 --> 00:27:54,646 A:middle
So I went out and made a big
circuit around Brookline.

613
00:27:55,486 --> 00:27:56,476 A:middle
This situates you.

614
00:27:56,476 --> 00:27:57,726 A:middle
There is Logan Airport.

615
00:27:58,466 --> 00:27:59,876 A:middle
Here is Boston proper.

616

617
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

618
00:28:00,816 --> 00:28:01,936 A:middle
There's Cambridge.

619
00:28:02,816 --> 00:28:04,706 A:middle
Now let's just zoom back in.

620
00:28:05,046 --> 00:28:09,116 A:middle
Oh, I said I was going
to show you a GPX file.

621
00:28:09,736 --> 00:28:11,426 A:middle
So this is what a
GPX file looks like.

622
00:28:11,426 --> 00:28:14,636 A:middle
It's just XML formatted,
longitudes, latitudes,

623
00:28:14,636 --> 00:28:16,286 A:middle
elevations, time stamps.

624
00:28:16,696 --> 00:28:21,486 A:middle
That's it, nothing
more in there.

625
00:28:21,686 --> 00:28:24,206 A:middle
So let's go here and
run a Web service.

626
00:28:24,206 --> 00:28:25,306 A:middle
I am going to go out and find

627
00:28:25,306 --> 00:28:27,826 A:middle
out from a government Web
server what the weather was

628
00:28:27,826 --> 00:28:30,276 A:middle
like on this day, and I
discover it was quite windy,

629
00:28:30,276 --> 00:28:33,966 A:middle
it was 17 mile an hour average,
or for those who speak metric,

630
00:28:33,966 --> 00:28:38,016 A:middle
28.4, and it was 39
degrees Fahrenheit or,

631
00:28:38,016 --> 00:28:40,556 A:middle
interesting factoid,
3.9 centigrade.

632
00:28:41,516 --> 00:28:44,666 A:middle
Thanksgiving day, that's why
there's nobody on the street.

633
00:28:44,666 --> 00:28:46,456 A:middle
You see, it figured out
this this was a holiday.

634
00:28:46,456 --> 00:28:48,026 A:middle
It's also the second
night of Hanukkah.

635
00:28:49,086 --> 00:28:52,626 A:middle
Okay? So just these Web
Services have allowed me

636
00:28:52,626 --> 00:28:54,656 A:middle
to deduce why there's
nobody on the street.

637
00:28:54,926 --> 00:28:58,286 A:middle
Now I am running another
Web Service called reverse

638
00:28:58,336 --> 00:29:01,936 A:middle
geocoding, where I am sending
each longitude and latitude

639

640
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

641
00:28:58,336 --> 00:29:01,936 A:middle
geocoding, where I am sending
each longitude and latitude

642
00:29:02,266 --> 00:29:05,026 A:middle
out to a server at
Apple, and it's going

643
00:29:05,026 --> 00:29:08,426 A:middle
to hand me back a
state, city, street,

644
00:29:08,666 --> 00:29:10,336 A:middle
and sometimes even
a street number.

645
00:29:10,716 --> 00:29:12,486 A:middle
Basically, it's going
to give me information

646
00:29:12,486 --> 00:29:14,146 A:middle
about the streets that I was on.

647
00:29:14,766 --> 00:29:17,396 A:middle
So we will wait here while all
these street pins fall down.

648
00:29:18,916 --> 00:29:21,946 A:middle
Then we can select one of them
to find out what street that is,

649
00:29:21,946 --> 00:29:24,076 A:middle
so that's Commonwealth Avenue.

650
00:29:25,256 --> 00:29:27,936 A:middle
Or here's Washington
Street in Brookline.

651
00:29:28,526 --> 00:29:32,466 A:middle
Now, I added a search bar
so I could type in, say,

652
00:29:32,466 --> 00:29:35,876 A:middle
Commonwealth Avenue, and it will
highlight it when it finds it.

653
00:29:36,466 --> 00:29:38,496 A:middle
So if I put this
data into my file,

654
00:29:38,496 --> 00:29:42,066 A:middle
now I have complete
searchability on street names.

655
00:29:42,066 --> 00:29:45,126 A:middle
I can go in and find all
those little clips where I am

656
00:29:45,486 --> 00:29:46,646 A:middle
on a particular street.

657
00:29:48,496 --> 00:29:51,186 A:middle
So let's hide those, and
the last thing we need

658
00:29:51,186 --> 00:29:54,406 A:middle
to do is synchronize our
video with our location data,

659
00:29:55,046 --> 00:29:57,256 A:middle
and I tried various
automatic ways to do this,

660
00:29:57,286 --> 00:30:00,846 A:middle
but I discovered the only really
good way to do it was to go

661

662
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

663
00:29:57,286 --> 00:30:00,846 A:middle
but I discovered the only really
good way to do it was to go

664
00:30:00,846 --> 00:30:05,186 A:middle
to a frame in the video where
I knew where I was on the map,

665
00:30:05,226 --> 00:30:09,616 A:middle
and then I am going to come
over onto the map and click it

666
00:30:09,616 --> 00:30:13,566 A:middle
and say synchronize the video
to this location right here.

667
00:30:14,416 --> 00:30:15,956 A:middle
Now, when I do this,
if I come back

668
00:30:15,956 --> 00:30:17,376 A:middle
and start playing the video,

669
00:30:17,376 --> 00:30:20,726 A:middle
you will see the pin moves
along with the video.

670
00:30:20,986 --> 00:30:22,446 A:middle
See, these are now synchronized.

671
00:30:23,666 --> 00:30:25,196 A:middle
And I can even go
the other direction.

672
00:30:25,196 --> 00:30:28,016 A:middle
I can go to someplace on
the map, and I can click it

673
00:30:28,016 --> 00:30:31,316 A:middle
and say make the movie
go there, and now I am

674
00:30:31,316 --> 00:30:32,546 A:middle
on Commonwealth Avenue,

675
00:30:32,896 --> 00:30:35,896 A:middle
and I know this is a
particularly fun downhill slope,

676
00:30:35,896 --> 00:30:37,776 A:middle
and we will just let
this ride for a second.

677
00:30:38,286 --> 00:30:40,616 A:middle
And this is really why we do
this, right, for these kind

678
00:30:40,616 --> 00:30:45,536 A:middle
of downhill with no cars and
what could possibly go wrong?

679
00:30:46,516 --> 00:30:48,706 A:middle
[Laughter]

680
00:30:49,206 --> 00:30:50,356 A:middle
Okay. So that's Alvin.

681
00:30:50,356 --> 00:30:52,266 A:middle
You can see that Alvin
has solved the second

682
00:30:52,266 --> 00:30:53,496 A:middle
and third problems for me.

683
00:30:54,256 --> 00:30:59,926 A:middle
It's added custom metadata to
my sample reference movie file.

684

685
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

686
00:31:00,386 --> 00:31:02,206 A:middle
And it basically
does it like this.

687
00:31:02,606 --> 00:31:05,776 A:middle
It gets the existing
metadata by calling the --

688
00:31:06,146 --> 00:31:07,666 A:middle
looking at the metadata
property.

689
00:31:08,376 --> 00:31:10,186 A:middle
We'll create a new
metadata item,

690
00:31:10,546 --> 00:31:12,706 A:middle
we'll fill in its
properties accordingly.

691
00:31:12,896 --> 00:31:16,136 A:middle
For instance, the average wind
speed value is the value I got

692
00:31:16,136 --> 00:31:18,786 A:middle
from the government server
telling me what the weather was

693
00:31:18,786 --> 00:31:19,356 A:middle
on that day.

694
00:31:20,066 --> 00:31:23,046 A:middle
And I just create some
identifier here that I can look

695
00:31:23,046 --> 00:31:26,726 A:middle
for later, and once I've
written this into the file

696
00:31:26,726 --> 00:31:30,766 A:middle
with the right movie header to
URL, my movie is all updated.

697
00:31:31,346 --> 00:31:33,686 A:middle
Now let's look at step three,

698
00:31:33,826 --> 00:31:37,096 A:middle
which is to add the location
data as a time metadata track.

699
00:31:37,836 --> 00:31:39,686 A:middle
You already know how to do this.

700
00:31:39,926 --> 00:31:41,236 A:middle
If you were here last year

701
00:31:42,166 --> 00:31:45,216 A:middle
and heard the talk Harnessing
Metadata in Audiovisual Media,

702
00:31:45,656 --> 00:31:47,476 A:middle
they showed a couple things.

703
00:31:47,556 --> 00:31:51,896 A:middle
First how to get location
data from a capture session,

704
00:31:52,546 --> 00:31:56,046 A:middle
and how to right-time
metadata into a movie.

705
00:31:56,726 --> 00:31:58,966 A:middle
Well, we've got our
location data.

706
00:31:58,966 --> 00:32:00,646 A:middle
It's in our GPX file.

707

708
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

709
00:31:58,966 --> 00:32:00,646 A:middle
It's in our GPX file.

710
00:32:00,646 --> 00:32:03,316 A:middle
So we don't need that
capture session stuff.

711
00:32:03,736 --> 00:32:06,256 A:middle
We can just focus on
taking the source code

712
00:32:06,256 --> 00:32:08,716 A:middle
in that second sample
code package

713
00:32:09,046 --> 00:32:10,446 A:middle
and putting it into Alvin.

714
00:32:11,236 --> 00:32:13,976 A:middle
Now, once we've done
that, what we end up with

715
00:32:14,176 --> 00:32:18,036 A:middle
on disk is a timed file that has
a single metadata track in it,

716
00:32:18,526 --> 00:32:22,666 A:middle
and all we have to do is copy
that track into a new track

717
00:32:23,246 --> 00:32:27,926 A:middle
in our movie, and we will do
it by opening the GPS asset.

718
00:32:29,276 --> 00:32:31,206 A:middle
We'll then add a new track

719
00:32:31,316 --> 00:32:35,736 A:middle
to our movie using whatever
media type happens to be

720
00:32:35,736 --> 00:32:39,636 A:middle
in that track, and we will copy
the settings from that track.

721
00:32:40,956 --> 00:32:45,956 A:middle
Finally, we insert that range
into this new track, and again,

722
00:32:45,956 --> 00:32:49,336 A:middle
if we write this header
into our file, we are done.

723
00:32:49,966 --> 00:32:55,876 A:middle
Now, the last thing we need
to do -- this is optional --

724
00:32:56,226 --> 00:32:59,886 A:middle
is create a track association
between the timed media track

725

726
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

727
00:33:00,386 --> 00:33:03,716 A:middle
and whatever track it is
metadata for, and in this case,

728
00:33:03,716 --> 00:33:05,116 A:middle
we have chosen the video track.

729
00:33:06,206 --> 00:33:10,086 A:middle
If you leave this step out, the
timed video track is assumed

730
00:33:10,086 --> 00:33:13,596 A:middle
to apply to the file as
a whole, and we are fine

731
00:33:13,596 --> 00:33:20,826 A:middle
as far as that's concerned.

732
00:33:20,826 --> 00:33:23,206 A:middle
If you are working
with AVMutableMovie,

733
00:33:23,366 --> 00:33:24,866 A:middle
there are a couple of
things to keep in mind.

734
00:33:25,746 --> 00:33:30,676 A:middle
As you know, an AVMovie or an
AVMutableMovie is an AVAsset

735
00:33:30,676 --> 00:33:31,786 A:middle
because it's a subclass.

736
00:33:32,306 --> 00:33:33,476 A:middle
So anything that you can do

737
00:33:33,476 --> 00:33:36,246 A:middle
with an AVAsset you can
do with a mutable movie.

738
00:33:36,706 --> 00:33:39,946 A:middle
For instance, you could
play it using AVPlayerItem,

739
00:33:40,766 --> 00:33:44,216 A:middle
you could grab an image from it
using an AVAssetImageGenerator.

740
00:33:44,336 --> 00:33:47,936 A:middle
You could export it using
an AVAssetExportSession.

741
00:33:48,376 --> 00:33:53,616 A:middle
Now, if you do any of these
operations on a mutable movie,

742
00:33:54,146 --> 00:33:56,236 A:middle
we highly recommend
that you make a copy

743
00:33:56,236 --> 00:34:00,366 A:middle
of that mutable movie because if
you're changing the movie while

744

745
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

746
00:33:56,236 --> 00:34:00,366 A:middle
of that mutable movie because if
you're changing the movie while

747
00:34:00,366 --> 00:34:02,776 A:middle
you are exporting it,
bad things will happen.

748
00:34:02,886 --> 00:34:05,036 A:middle
So just make a copy
of it, do your export,

749
00:34:05,036 --> 00:34:06,226 A:middle
and everything works fine.

750
00:34:06,776 --> 00:34:13,226 A:middle
The second best practice is
that if you are opening an asset

751
00:34:13,315 --> 00:34:16,806 A:middle
that you want to insert
into an AVMutableMovie,

752
00:34:17,815 --> 00:34:22,396 A:middle
you should set this flag, AV URL
asset prefer precise duration

753
00:34:22,396 --> 00:34:24,606 A:middle
and timing key, to true.

754
00:34:25,045 --> 00:34:27,156 A:middle
Now, we haven't done this
in any of the code snippets

755
00:34:27,156 --> 00:34:31,525 A:middle
that you've seen so far because
when you open a QuickTime movie,

756
00:34:31,726 --> 00:34:33,246 A:middle
this flag is already
set to true.

757
00:34:33,636 --> 00:34:36,166 A:middle
But if you were to open
an MP3 file, for instance,

758
00:34:36,166 --> 00:34:38,485 A:middle
and wanted to insert that
into a mutable movie,

759
00:34:38,775 --> 00:34:41,775 A:middle
you would want to set this flag.

760
00:34:41,775 --> 00:34:42,686 A:middle
So let's summarize.

761
00:34:44,065 --> 00:34:46,436 A:middle
We've added new classes
to support editing

762
00:34:46,576 --> 00:34:48,726 A:middle
on QuickTime movie files.

763
00:34:50,065 --> 00:34:51,806 A:middle
This gives us, as
I hope you've seen,

764
00:34:52,556 --> 00:34:55,085 A:middle
a really nice, simplified
workflow.

765
00:34:55,085 --> 00:34:58,176 A:middle
We are able to work on
reference movies and not

766
00:34:58,176 --> 00:34:59,846 A:middle
on the original movies
themselves.

767

768
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00,000

769
00:35:00,116 --> 00:35:01,666 A:middle
So if you are handling
large amounts

770
00:35:01,666 --> 00:35:03,786 A:middle
of data, this is for you.

771
00:35:04,116 --> 00:35:07,616 A:middle
If you want to see how
this works in practice,

772
00:35:07,616 --> 00:35:11,206 A:middle
download AVMovieEditor
and take a look at that.

773
00:35:11,396 --> 00:35:13,686 A:middle
For more information, go
to the standard places.

774
00:35:14,246 --> 00:35:17,106 A:middle
And if you have questions
about this, we'll be in the lab

775
00:35:17,106 --> 00:35:18,296 A:middle
on Thursday and Friday.

776
00:35:19,116 --> 00:35:20,486 A:middle
If you want to look at the --

777
00:35:20,486 --> 00:35:23,986 A:middle
how to work with
compositions, jump back to 2010.

778
00:35:24,656 --> 00:35:27,236 A:middle
And finally, if you want
to see in great detail how

779
00:35:27,236 --> 00:35:29,976 A:middle
to do the timed metadata
track generation,

780
00:35:30,526 --> 00:35:31,676 A:middle
go to last year's session,

781
00:35:31,676 --> 00:35:33,566 A:middle
Harnessing Metadata
in Audiovisual media.

782
00:35:34,426 --> 00:35:34,976 A:middle
Thank you very much.

783
00:35:35,516 --> 00:35:40,500 A:middle
[Applause]

784
